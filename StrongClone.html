import React, { useState, useEffect } from 'react'
// Strong-like single-file React component (Tailwind + shadcn/ui + recharts)
// Usage notes (put in README or run in a CRA/Vite app with Tailwind):
// npm i react react-dom recharts lucide-react
// shadcn/ui components are referenced but optional — replace with your own Button/Card if not using shadcn.

import { Card, CardContent } from '@/components/ui/card'
import { Button } from '@/components/ui/button'
import { Plus } from 'lucide-react'
import { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer } from 'recharts'

export default function StrongLikeApp() {
  // Data structures: workouts -> [{id,title,date,exercises:[{id,name,sets:[{weight,reps,id}]}]}]
  const [workouts, setWorkouts] = useState(() => {
    try {
      const raw = localStorage.getItem('sl_workouts')
      return raw ? JSON.parse(raw) : sampleData()
    } catch (e) {
      return sampleData()
    }
  })
  const [activeId, setActiveId] = useState(workouts[0]?.id || null)
  const [newExerciseName, setNewExerciseName] = useState('')

  useEffect(() => {
    localStorage.setItem('sl_workouts', JSON.stringify(workouts))
  }, [workouts])

  function sampleData() {
    const now = new Date().toISOString()
    return [
      {
        id: 'w1',
        title: 'Full Body',
        date: now,
        exercises: [
          { id: 'e1', name: 'Back Squat', sets: [{ id: 's1', weight: 225, reps: 5 }, { id: 's2', weight: 225, reps: 5 }] },
          { id: 'e2', name: 'Bench Press', sets: [{ id: 's3', weight: 165, reps: 5 }] }
        ]
      }
    ]
  }

  function addWorkout() {
    const id = `w${Date.now()}`
    const w = { id, title: 'New Workout', date: new Date().toISOString(), exercises: [] }
    setWorkouts([w, ...workouts])
    setActiveId(id)
  }

  function updateWorkout(id, change) {
    setWorkouts(workouts.map(w => (w.id === id ? { ...w, ...change } : w)))
  }

  function addExercise(workoutId, name) {
    if (!name) return
    const ex = { id: `e${Date.now()}`, name, sets: [{ id: `s${Date.now()}a`, weight: 0, reps: 0 }] }
    setWorkouts(workouts.map(w => (w.id === workoutId ? { ...w, exercises: [ex, ...w.exercises] } : w)))
    setNewExerciseName('')
  }

  function addSet(workoutId, exId) {
    setWorkouts(workouts.map(w => {
      if (w.id !== workoutId) return w
      return {
        ...w,
        exercises: w.exercises.map(ex => ex.id === exId ? { ...ex, sets: [{ id: `s${Date.now()}`, weight: 0, reps: 0 }, ...ex.sets] } : ex)
      }
    }))
  }

  function updateSet(workoutId, exId, setId, change) {
    setWorkouts(workouts.map(w => {
      if (w.id !== workoutId) return w
      return {
        ...w,
        exercises: w.exercises.map(ex => ex.id === exId ? { ...ex, sets: ex.sets.map(s => s.id === setId ? { ...s, ...change } : s) } : ex)
      }
    }))
  }

  function deleteSet(workoutId, exId, setId) {
    setWorkouts(workouts.map(w => {
      if (w.id !== workoutId) return w
      return {
        ...w,
        exercises: w.exercises.map(ex => ex.id === exId ? { ...ex, sets: ex.sets.filter(s => s.id !== setId) } : ex)
      }
    }))
  }

  function deleteExercise(workoutId, exId) {
    setWorkouts(workouts.map(w => (w.id === workoutId ? { ...w, exercises: w.exercises.filter(e => e.id !== exId) } : w)))
  }

  function removeWorkout(id) {
    const remaining = workouts.filter(w => w.id !== id)
    setWorkouts(remaining)
    if (remaining[0]) setActiveId(remaining[0].id)
    else setActiveId(null)
  }

  function exportCSV() {
    // Simple CSV export of workouts
    const rows = ['workout_id,workout_title,exercise_id,exercise_name,set_id,weight,reps,date']
    workouts.forEach(w => {
      w.exercises.forEach(ex => ex.sets.forEach(s => {
        rows.push([w.id, csvSafe(w.title), ex.id, csvSafe(ex.name), s.id, s.weight, s.reps, w.date].join(','))
      }))
    })
    const blob = new Blob([rows.join('\n')], { type: 'text/csv' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = 'workouts.csv'
    a.click()
    URL.revokeObjectURL(url)
  }

  function csvSafe(s) { return `"${String(s).replace(/\"/g, '""')}"` }

  const active = workouts.find(w => w.id === activeId) || workouts[0] || null

  // Build chart data for a chosen exercise (show 7 recent sets weights)
  const chartData = () => {
    if (!active) return []
    const ex = active.exercises[0]
    if (!ex) return []
    return ex.sets.slice(0, 12).map((s, i) => ({ name: `${i+1}`, weight: s.weight }))
  }

  return (
    <div className="min-h-screen bg-slate-50 p-6">
      <div className="max-w-6xl mx-auto grid md:grid-cols-4 gap-6">
        {/* Sidebar */}
        <aside className="md:col-span-1">
          <Card>
            <CardContent>
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-xl font-semibold">Workouts</h2>
                <Button onClick={addWorkout} aria-label="Add workout"><Plus size={16} /></Button>
              </div>
              <div className="space-y-2">
                {workouts.map(w => (
                  <div key={w.id} className={`p-3 rounded-md cursor-pointer ${w.id === activeId ? 'bg-slate-100' : 'hover:bg-white'}`} onClick={() => setActiveId(w.id)}>
                    <div className="flex justify-between">
                      <div>
                        <div className="font-medium">{w.title}</div>
                        <div className="text-xs text-slate-500">{new Date(w.date).toLocaleString()}</div>
                      </div>
                      <div className="text-xs text-red-500 cursor-pointer" onClick={(e) => { e.stopPropagation(); removeWorkout(w.id) }}>Delete</div>
                    </div>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </aside>

        {/* Main */}
        <main className="md:col-span-3">
          {!active ? (
            <div className="text-center p-10 bg-white rounded shadow">No workouts. Click + to add one.</div>
          ) : (
            <Card>
              <CardContent>
                <div className="flex items-start justify-between mb-4">
                  <div>
                    <input className="text-2xl font-bold bg-transparent outline-none" value={active.title}
                      onChange={e => updateWorkout(active.id, { title: e.target.value })} />
                    <div className="text-sm text-slate-500">{new Date(active.date).toLocaleDateString()}</div>
                  </div>
                  <div className="flex gap-2">
                    <Button onClick={exportCSV}>Export CSV</Button>
                    <Button onClick={() => { localStorage.removeItem('sl_workouts'); setWorkouts(sampleData()); }}>Reset</Button>
                  </div>
                </div>

                {/* Add exercise */}
                <div className="flex gap-2 mb-4">
                  <input className="flex-1 p-2 rounded border" placeholder="Add exercise (e.g. Deadlift)" value={newExerciseName} onChange={e => setNewExerciseName(e.target.value)} />
                  <Button onClick={() => addExercise(active.id, newExerciseName)}>Add</Button>
                </div>

                {/* Exercises list */}
                <div className="space-y-4">
                  {active.exercises.map(ex => (
                    <div key={ex.id} className="p-4 bg-white rounded shadow-sm">
                      <div className="flex items-center justify-between mb-2">
                        <div className="font-semibold text-lg">{ex.name}</div>
                        <div className="flex gap-2">
                          <Button onClick={() => addSet(active.id, ex.id)}>Add Set</Button>
                          <Button onClick={() => deleteExercise(active.id, ex.id)}>Remove Exercise</Button>
                        </div>
                      </div>

                      <div className="grid grid-cols-12 gap-2 items-center">
                        <div className="col-span-8">
                          {ex.sets.map(s => (
                            <div key={s.id} className="flex gap-2 items-center mb-2">
                              <input className="w-24 p-1 rounded border" type="number" value={s.weight} onChange={e => updateSet(active.id, ex.id, s.id, { weight: Number(e.target.value) })} />
                              <input className="w-20 p-1 rounded border" type="number" value={s.reps} onChange={e => updateSet(active.id, ex.id, s.id, { reps: Number(e.target.value) })} />
                              <div className="text-sm text-slate-500">{s.weight} lb × {s.reps}</div>
                              <Button onClick={() => deleteSet(active.id, ex.id, s.id)}>Delete</Button>
                            </div>
                          ))}
                        </div>
                        <div className="col-span-4 h-40">
                          {/* Simple mini chart for the exercise */}
                          <ResponsiveContainer width="100%" height={160}>
                            <LineChart data={ex.sets.slice(0, 12).map((s, i) => ({ name: `${i+1}`, weight: s.weight }))}>
                              <XAxis dataKey="name" />
                              <YAxis />
                              <Tooltip />
                              <Line type="monotone" dataKey="weight" strokeWidth={2} />
                            </LineChart>
                          </ResponsiveContainer>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>

              </CardContent>
            </Card>
          )}
        </main>
      </div>
    </div>
  )
}

/*
Notes & next steps:
- This is intentionally a single-file high-fidelity starting point. It reproduces the core flows: create workout, add exercises, add/edit sets, quick charting, CSV export, localStorage persistence.
- To get closer to an "exact" Strong app replica you'd need to: 1) replace visual assets (icons, fonts) with the app's assets only if you have license; 2) re-create animations & micro-interactions; 3) build backend sync, account system, and advanced analytics.
- Integration suggestions: use a backend (Firebase or custom REST API) to sync across devices, add authentication, and store history. Add unit tests and e2e tests.
*/
